<!DOCTYPE html>
<html>
  <body style="margin: 0; background: #1e1e1e; color: #f5f5f5; font-family: monospace;">
    <pre id="output">Waiting for input...</pre>
    
    <script>
      window.addEventListener("message", async (event) => {
        let userCode = event.data;
        console.log("üì• Received message:", userCode); // ‚úÖ log incoming code

        // Replace `export default` with CommonJS `module.exports =`
        userCode = userCode.replace(/export\s+default/, "module.exports =");

        try {
          const exports = {};
          const module = { exports };
          const wrappedCode = `(function(exports, module) { ${userCode} })(exports, module);`;
          eval(wrappedCode);

          if (typeof module.exports.fetch === "function") {
            console.log("‚öôÔ∏è fetch() found. Running...");
            const response = await module.exports.fetch(new Request("http://localhost"));
            const text = await response.text();
            document.getElementById("output").textContent = text;
          } else {
            console.log("‚ùå fetch() not found");
            document.getElementById("output").textContent = "‚ùå No fetch() function exported.";
          }
        } catch (err) {
          console.error("‚ö†Ô∏è Error running code:", err);
          document.getElementById("output").textContent = "‚ö†Ô∏è Error:\n" + err;
        }
      });
    </script>
  </body>
</html>
